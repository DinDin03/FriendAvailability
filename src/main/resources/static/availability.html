<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Calendar - LinkUp</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="dashboard">
<!-- Header Navigation -->
<header class="dashboard-header">
  <nav class="dashboard-nav">
    <div class="nav-brand">
      <h2>📅 LinkUp</h2>
    </div>
    <div class="nav-center">
      <a href="dashboard.html" class="nav-btn">Dashboard</a>
      <a href="friends.html" class="nav-btn">Friends</a>
      <a href="availability.html" class="nav-btn active">Calendar</a>
      <a href="schedule.html" class="nav-btn">Schedule</a>
      <a href="profile.html" class="nav-btn">Profile</a>
    </div>
    <div class="nav-user">
      <div class="user-info">
        <span id="userName">Loading...</span>
        <img id="userAvatar" src="" alt="Profile" class="user-avatar">
      </div>
      <button onclick="logout()" class="btn btn-outline btn-small">Logout</button>
    </div>
  </nav>
</header>

<div class="dashboard-container">
  <!-- Page Header -->
  <div class="section-header">
    <h1>My Calendar</h1>
    <p>Manage your availability and schedule events</p>
  </div>

  <!-- Quick Stats -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon">📅</div>
      <div class="stat-content">
        <div class="stat-number" id="totalEvents">0</div>
        <div class="stat-label">Total Events</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">🟢</div>
      <div class="stat-content">
        <div class="stat-number" id="freeSlots">0</div>
        <div class="stat-label">Free Time Slots</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">🔴</div>
      <div class="stat-content">
        <div class="stat-number" id="busySlots">0</div>
        <div class="stat-label">Busy Times</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">⏰</div>
      <div class="stat-content">
        <div class="stat-number" id="upcomingEvents">0</div>
        <div class="stat-label">Upcoming</div>
      </div>
    </div>
  </div>

  <!-- Calendar Controls -->
  <div class="card">
    <div class="card-header">
      <h3>Calendar View</h3>
      <div class="calendar-controls">
        <div class="view-selector">
          <button onclick="setCalendarView('today')" class="btn btn-secondary btn-small" id="todayBtn">Today</button>
          <button onclick="setCalendarView('week')" class="btn btn-secondary btn-small" id="weekBtn">Week</button>
          <button onclick="setCalendarView('month')" class="btn btn-secondary btn-small active" id="monthBtn">Month</button>
        </div>
        <div class="date-navigation">
          <button onclick="navigateCalendar('prev')" class="btn btn-outline btn-small">← Previous</button>
          <div class="current-date">
            <input type="date" id="calendarDate" onchange="onDateChange()">
          </div>
          <button onclick="navigateCalendar('next')" class="btn btn-outline btn-small">Next →</button>
        </div>
        <div class="calendar-actions">
          <button onclick="showCreateEventModal()" class="btn btn-primary">+ Add Event</button>
          <button onclick="refreshCalendar()" class="btn btn-secondary btn-small">Refresh</button>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div id="calendarContainer" class="calendar-container">
        <div class="loading">Loading your calendar...</div>
      </div>
    </div>
  </div>

  <!-- Today's Schedule -->
  <div class="card">
    <div class="card-header">
      <h3>Today's Schedule</h3>
      <span class="card-subtitle" id="todayDate">Loading...</span>
    </div>
    <div id="todaySchedule" class="schedule-container">
      <div class="loading">Loading today's events...</div>
    </div>
  </div>

  <!-- Upcoming Events -->
  <div class="card">
    <div class="card-header">
      <h3>Upcoming Events</h3>
      <p class="card-subtitle">Your next events and commitments</p>
    </div>
    <div id="upcomingEventsContainer" class="events-container">
      <div class="loading">Loading upcoming events...</div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="card">
    <div class="card-header">
      <h3>Quick Actions</h3>
    </div>
    <div class="card-body">
      <div class="quick-actions">
        <button onclick="addQuickEvent('meeting')" class="action-btn">
          <span class="action-icon">🏢</span>
          <span class="action-label">Add Meeting</span>
        </button>
        <button onclick="addQuickEvent('break')" class="action-btn">
          <span class="action-icon">☕</span>
          <span class="action-label">Schedule Break</span>
        </button>
        <button onclick="addQuickEvent('lunch')" class="action-btn">
          <span class="action-icon">🍽️</span>
          <span class="action-label">Lunch Time</span>
        </button>
        <button onclick="addQuickEvent('free')" class="action-btn">
          <span class="action-icon">🟢</span>
          <span class="action-label">Mark Free Time</span>
        </button>
        <button onclick="addQuickEvent('busy')" class="action-btn">
          <span class="action-icon">🔴</span>
          <span class="action-label">Mark Busy</span>
        </button>
        <button onclick="viewCompleteCalendar()" class="action-btn">
          <span class="action-icon">📊</span>
          <span class="action-label">Complete View</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Calendar Legend -->
  <div class="card">
    <div class="card-header">
      <h3>Legend</h3>
    </div>
    <div class="card-body">
      <div class="calendar-legend">
        <div class="legend-item">
          <span class="legend-color busy"></span>
          <span class="legend-label">Busy / Meetings</span>
        </div>
        <div class="legend-item">
          <span class="legend-color free"></span>
          <span class="legend-label">Available / Free Time</span>
        </div>
        <div class="legend-item">
          <span class="legend-color all-day"></span>
          <span class="legend-label">All Day Events</span>
        </div>
        <div class="legend-item">
          <span class="legend-color current"></span>
          <span class="legend-label">Current Time</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create Event Modal -->
<div id="createEventModal" class="modal">
  <div class="modal-content modal-large">
    <div class="modal-header">
      <h3>Create New Event</h3>
      <button class="modal-close" onclick="closeModal('createEventModal')">&times;</button>
    </div>
    <div class="modal-body">
      <form id="createEventForm" class="event-form">
        <div class="form-row">
          <div class="form-group">
            <label for="eventTitle">Event Title *</label>
            <input type="text" id="eventTitle" placeholder="Meeting, Coffee, Lunch..." required>
          </div>
          <div class="form-group">
            <label for="eventType">Type *</label>
            <select id="eventType" required>
              <option value="">Select type...</option>
              <option value="busy">🔴 Busy (not available)</option>
              <option value="free">🟢 Available (free time)</option>
              <option value="meeting">🏢 Meeting</option>
              <option value="personal">👤 Personal</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="eventStartTime">Start Time *</label>
            <input type="datetime-local" id="eventStartTime" required>
          </div>
          <div class="form-group">
            <label for="eventEndTime">End Time *</label>
            <input type="datetime-local" id="eventEndTime" required>
          </div>
        </div>

        <div class="form-group">
          <label for="eventDescription">Description</label>
          <textarea id="eventDescription" placeholder="Meeting agenda, notes..." rows="3"></textarea>
        </div>

        <div class="form-group">
          <label for="eventLocation">Location</label>
          <input type="text" id="eventLocation" placeholder="Conference room, Zoom, Coffee shop...">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="eventAllDay">
              <span>All day event</span>
            </label>
          </div>
          <div class="form-group">
            <label for="eventReminder">Reminder</label>
            <select id="eventReminder">
              <option value="0">No reminder</option>
              <option value="5">5 minutes before</option>
              <option value="15">15 minutes before</option>
              <option value="30" selected>30 minutes before</option>
              <option value="60">1 hour before</option>
              <option value="120">2 hours before</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" onclick="closeModal('createEventModal')" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Event</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Event Modal -->
<div id="editEventModal" class="modal">
  <div class="modal-content modal-large">
    <div class="modal-header">
      <h3>Edit Event</h3>
      <button class="modal-close" onclick="closeModal('editEventModal')">&times;</button>
    </div>
    <div class="modal-body">
      <form id="editEventForm" class="event-form">
        <input type="hidden" id="editEventId">

        <div class="form-row">
          <div class="form-group">
            <label for="editEventTitle">Event Title *</label>
            <input type="text" id="editEventTitle" required>
          </div>
          <div class="form-group">
            <label for="editEventType">Type *</label>
            <select id="editEventType" required>
              <option value="busy">🔴 Busy (not available)</option>
              <option value="free">🟢 Available (free time)</option>
              <option value="meeting">🏢 Meeting</option>
              <option value="personal">👤 Personal</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="editEventStartTime">Start Time *</label>
            <input type="datetime-local" id="editEventStartTime" required>
          </div>
          <div class="form-group">
            <label for="editEventEndTime">End Time *</label>
            <input type="datetime-local" id="editEventEndTime" required>
          </div>
        </div>

        <div class="form-group">
          <label for="editEventDescription">Description</label>
          <textarea id="editEventDescription" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label for="editEventLocation">Location</label>
          <input type="text" id="editEventLocation">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="editEventAllDay">
              <span>All day event</span>
            </label>
          </div>
          <div class="form-group">
            <label for="editEventReminder">Reminder</label>
            <select id="editEventReminder">
              <option value="0">No reminder</option>
              <option value="5">5 minutes before</option>
              <option value="15">15 minutes before</option>
              <option value="30">30 minutes before</option>
              <option value="60">1 hour before</option>
              <option value="120">2 hours before</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" onclick="deleteEvent()" class="btn btn-danger">Delete Event</button>
          <button type="button" onclick="closeModal('editEventModal')" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Event</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Complete Calendar View Modal -->
<div id="completeCalendarModal" class="modal">
  <div class="modal-content modal-extra-large">
    <div class="modal-header">
      <h3>Complete Calendar View</h3>
      <p class="modal-subtitle">All events with inferred free time slots</p>
      <button class="modal-close" onclick="closeModal('completeCalendarModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="complete-calendar-controls">
        <div class="date-range-selector">
          <label for="completeStartDate">From:</label>
          <input type="date" id="completeStartDate">
          <label for="completeEndDate">To:</label>
          <input type="date" id="completeEndDate">
          <button onclick="loadCompleteView()" class="btn btn-primary btn-small">Load</button>
        </div>
      </div>
      <div id="completeCalendarContainer" class="complete-calendar-container">
        <div class="loading">Select date range and click Load</div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
  <div class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>
</div>

<!-- Message Container -->
<div id="messageContainer" class="message-container"></div>

<!-- Include JavaScript -->
<script src="shared.js"></script>
<script src="availability.js"></script>
</body>
</html>